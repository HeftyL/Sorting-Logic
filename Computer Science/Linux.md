# 基础篇

## linux入门

- multics 多用户分时->Unix Ken tompson->GUN计划 Richard Stallman->GUN/linux Linus Torvalds->Linux发行版：Ubuntu、Redhat（centOS是社区版，免费。enterprise是商业版）

## 主机规划和磁盘分区

- 设备名称与linux文件的对应
  - ![image-20220914140824098](Linux.assets/image-20220914140824098.png)

### MBR

- master boot record
- 处理开机管理程序与分区表！而开机管理程序纪录区与分区表则通通放在磁盘的第一个扇区,这个扇区通常是512Bytes的大小
  - 主要开机记录区（Master	Boot	Record,	MBR）：可以安装开机管理程序的地方，有446Bytes
  - 分区表（partition	table）：记录整颗硬盘分区的状态，有64Bytes.每个分区需要16Bytes所有最多有四个分区
- MBR	主要分区(primary)、延伸分区（extend）与逻辑（logical）分区
  - 主要分区与延伸分区最多可以有四笔（硬盘的限制） 
  - 延伸分区最多只能有一个（操作系统的限制） 
  - 逻辑分区是由延伸分区持续切割出来的分区；
  - 能够被格式化后，作为数据存取的分区为主要分区与逻辑分区。延伸分区无法格式化； 
  - 逻辑分区的数量依操作系统而不同，在Linux系统中SATA硬盘已经可以突破63个以上的分区限制；

### GUID partition table

- GPT 磁盘分区表
- 目前已经有4K的扇区设计出现！为了相容 于所有的磁盘，在扇区的定义上面，大多会使用所谓的逻辑区块位址（Logical Block Address,LBA）来处理。

### Bios和UEFI

- ![image-20220914151026290](Linux.assets/image-20220914151026290.png)

## vim和linux的安装

- Swap分区：Swap分区在系统的物理内存不够用的时候，把硬盘内存中的一部分空间释放出来，以供当前运行的程序使用。那些被释放的空间可能来自一些很长时间没有什么操作的程序，这些被释放的空间被临时保存到Swap分区中，等到那些程序要运行时，再从Swap分区中恢复保存的数据到内存中。
- 网络连接
  - 桥接模式，虚拟系统可以和外部系统通讯，但是容易造成IP冲突
  - NAT模式，网络地址转换模扰,虚拟系统可以和外部系统通讯，不造成IP冲突
  - 主机模式:独立的系统
- vi command
  - u：undo，ctrl+r ：redo


## linux目录结构

- linux的文件系统是采用级层式的树状目录结构，在此结构中的最上层是根录“/”，然后在此目录下再创建其他的目录。
  - /bin：是Binary的缩写,这个目录存放着最经常使用的命令
  - /sbin(/usr/sbin 、 /usr/local/sbin)：s就是Super User的意思，这里存放的是系统管理员使用的系统管理程序。
  - /home：存放普通用户的主目录，在Linux 中每个用户都有一个自己的目录，一般该目录名是以用户的账号命名
  - /root：该目录为系统管理员，也称作超级权限者的用户主目录
  - /lib：系统开机所需要最基本的动态连接共享库，其作用类似于Windows里的DLL文件。几乎所有的应用程序都需要用到这些共享库
  - /lost+ found： 这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件
  - /etc：所有的系统管理所需要的配置文件和子目录,比如安装mysql数据库my.conf。
    - 早期UNIX中，贝尔实验室的解释是：etcetra directory 。 etc. 就是Et cetra。表示其他、等等什么的，英语里能常常看都这个缩写的。是用来放其他不能归类到其他目录中的内容。
    - 后来FHS规定用来放配置文件，就解释为："Editable Text Configuration" 或者 "Extended Tool Chest"。
  - /usr ：unix software resource。这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似与windows下的program files目录。
  - /boot：存放的是启动Linux时使用的一些核心文件，包括一些连接文件以及镜像文件
  - /proc：这个目录是一个虚拟的目录，他是系统内存的映射，访问这个目录来获取系统信息
  - /srv：service缩写，该目录存放一些服务启动之后需要提取的数据
  - /sys：这是linux2.6内核的一个很大的变化。该目录下安装了2.6内核中新出现的一个文件系统
  - /tmp：这个目录是用来存放一些临时文件的
  - /media：linux系统会自动识别一些设备，例如U盘、光驱等等，当识别后，linux会把识别的设备挂载到这个目录下
  - /mnt：系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将外部的存储挂载在/mnt/上,然后进入该目录就可以查看里的内容了。
  - /opt：Optional application software packages。这是给主机额外安装软件所存放的目录。如安装ORACLE数据库就可放到该目录下。默认为空

### 文件权限和目录配置

- | 文件类型 | 说明                                                         |
  | -------- | ------------------------------------------------------------ |
  | b        | 块设备（block），是一些提供系统存取数据的接口设备，例如硬盘。 |
  | c        | 字符设备（character），是一些串行端口的接口设备，例如键盘、鼠标、打印机、tty终端。 |
  | d        | 目录（directory），类似于Windows的文件夹。                   |
  | l        | 链接文件（link），类似于Windows的快捷方式。                  |
  | s        | 套接字文件（socket），用于进程之间的通信。                   |
  | -        | 文件，分纯文本文件（ASCII）和二进制文件（binary）。          |
  | p        | 管道文件(pipe)                                               |

  - ```java
    命令：file filename //查看文件类型
    ```

- | 文件颜色 | 说明           |
  | -------- | -------------- |
  | 蓝色     | 目录文件       |
  | 灰色     | 普通文件       |
  | 绿色     | 可执行文件     |
  | 红色     | 压缩文件       |
  | 红色闪烁 | 链接文件有问题 |
  | 浅蓝色   | 符号链接文件   |
  | 黄色     | 设备文件       |
  | 浅黄色   | 管道文件       |
  | 紫色     | 套接字文件     |

  - 目录为绿色填充：是因为其他组权限里面有写入的权限，linux系统认为这是一个高风险的目录文件，因为任何人都可以进入到该目录并进行写入操作，所以就将该目录用绿色高亮显示，警示用户这个文件存在可能被恶意写入的风险。

  - 目录为蓝色填充：当t权限在other x权限上时，任何人都可以在目录内新增、修改文件，但是普通用户不能删除其他人的文档，只能删除自己的。

  - 管道文件

    - 管道本质上就是一个文件，前面的进程以写方式打开文件，后面的进程以读方式打开。这样前面写完后面读，于是就实现了通信。实际上管道的设计也是遵循UNIX的“一切皆文件”设计原则的，它本质上就是一个文件。Linux系统直接把管道实现成了一种文件系统，借助VFS给应用程序提供操作接口。

    - 在任何一个shell中，都可以使用“|”连接两个命令，shell会将前后两个进程的输入输出用一个管道相连，以便达到进程间通信的目的

      - ```java
        [zorro@zorro-pc pipe]$ ls -l /etc/ | wc -l
        183
        ```

#### s和t两个特殊权限

- 当s权限在文件所有者 x 权限上时，即当执行该文件时将具有该文件所有者的权限。
- 当s权限在文件组 x 权限上时，执行者在执行该文件时将具有该文件所属组的权限。
- 当t权限在other x权限上时，任何人都可以在目录内新增、修改文件，但是只有该文件或目录的建立都与root用户能够删除自己的文件或目录。
  - 注意： 假如本来在该位上有x, 则这些特别标志 (suid, sgid, sticky) 显示为小写字母 (s, s, t).否则, 显示为大写字母 (S, S, T) 。

#### 文件和目录权限的区别

- 文件
  - r（read）：可读取此一文件的实际内容，如读取文本文件的文字内容等；
  - w（write）：可以编辑、新增或者是修改该文件的内容（但不含删除该文件）；
  - x（eXecute）：该文件具有可以被系统执行的权限。
- 目录
  - r（read	contents	in	directory）：
    - 表示具有读取目录结构清单的权限，所以当你具有读取（r）一个目录的权限时，表示你 
      可以查询该目录下的文件名数据。	所以你就可以利用	ls	这个指令将该目录的内容列表显 
      示出来！
  - w	（modify	contents	of	directory）：
    这个可写入的权限对目录来说，是很了不起的！	因为他表示你具有异动该目录结构清单 
    的权限，也就是下面这些权限：
    创建新的文件与目录；
    删除已经存在的文件与目录（不论该文件的权限为何！） 
    将已存在的文件或目录进行更名；
    搬移该目录内的文件、目录位置。	总之，目录的w权限就与该目录下面的文件名异 
    动有关就对了啦！
  - x（access	directory）：
    - 目录不可以被执行，目录的x代表的是使用者能否进入该目录成为工作目录的用途！ 
      - 工作目录（work	directory）就是你目前所在的目录啦
- 对于文件，x权限和rw权限互相独立；没r有w也不可以写文件。
- 对于目录，没有x无法rw目录下的文件，有了w，没有r也可以读写目录下的文件。

#### Linux文件扩展名

- Linux的文件是没有所谓的“扩展名”的，不过仍然希望可以借由扩展名来了解该文件是什么东西
- 类型
  - *.sh：脚本或批处理文件（scripts），因为批处理文件为使用shell写成的，所以扩展名就编成.sh；
  - `*Z`,.tar,.tar.gz,.zip,*.tgz：经过打包的压缩文件。这是因为压缩软件分别为gunzip,tar等等的，由于不同的压缩软件，而取其相关的扩展名啰！
  - .html,.php：网页相关文件，分别代表HTML语法与PHP语法的网页文件！.html的文件可使用网页浏览器来直接打开，至于.php的文件，则可以通过client端的浏览器来server端浏览

### 文件与目录管理

- 相对路径与绝对路径

- 目录命令

  - cd：变换目录（change directory）
  - pwd：显示目前的目录（Print Working Directory）
  - mkdir：创建一个新的目录（make directory）
  - rmdir：删除一个空的目录（remove directory）

- 可执行文件路径的变量：$PATH

  - 可执行文件路径的变量

  - 系统会依照PATH的设置去每个PATH定义 的目录下搜寻文件名为xxx的可可执行文件，	如果在PATH定义的目录中含有多个文件名为xxx的可执行文件，那么先搜寻到的同名指令先被执行！

  - ```java
    [root@study ~]# PATH="${PATH}:/root" #将/root加入到可执行文件路径的变量中
    ```

- 复制、删除与移动：cp（copy）,	rm（remove）,	mv（move）

- 取得路径的文件名称与目录名称

  - basename：参数为文件路径，取得最后的文件名
  - dirname：参数为目录路径，取得最后的完整路径

- 文件内容查阅

  - | 命令 | 说明                                                         |
    | ---- | ------------------------------------------------------------ |
    | cat  | concatenate，由第一行开始显示文件内容                        |
    | tac  | 从最后一行开始显示，可以看出tac是cat的倒着写！               |
    | nl   | 内容显示的时候，顺道输出行号！                               |
    | more | 一页一页的显示文件                                           |
    | less | 与	more	类似，但是比	more	更好的是，他可以往前翻页！ |
    | head | 只看头几行                                                   |
    | tail | 只看尾巴几行                                                 |
    | od   | 以二进制的方式读取文件内容！                                 |

- linux时间参数

  - modification time（mtime）：当该文件的“内容数据”变更时，就会更新这个时间！内容数据指的是文件的内容，而不是文件的属性或权限喔！
  - status time（ctime）：当该文件的“状态（status）”改变时，就会更新这个时间，举例来说，像是权限与属性被更改了，都会更新这个时间啊。
  - access time（atime）：当“该文件的内容被取用”时，就会更新这个读取时间（access）。举例来说，我们使用cat去读取	/etc/man_db.conf，就会更新该文件的 atime了。

- 文件默认权限：umask

  - umask：的分数指的是“该默认值需要减掉的权限！四位数字，依次为特殊权限、用户、组、其他

- 指令与文件的搜寻

  - which：（寻找“可执行文件”）。which默认是找PATH内所规范的目录
  - type
  - whereis	（由一些特定的目录中寻找文件文件名）

### 磁盘与文件系统管理

- superblock：记录此	filesystem	的整体信息，包括inode/block的总量、使用量、剩余量， 以及文件系统的格式与相关信息等；
- inode：记录文件的属性，一个文件占用一个inode，同时记录此文件的数据所在的block号码；
  - 记录的数据
    - 该文件的存取模式（read/write/excute）； 
    - 该文件的拥有者与群组（owner/group）； 
    - 该文件的容量；
    - 该文件创建或状态改变的时间（ctime）； 
    - 最近一次的读取时间（atime）； 
    - 最近修改的时间（mtime）；
    - 定义文件特性的旗标（flag），如	SetUID...； 
    - 该文件真正内容的指向（pointer）；
  - 注意
    - 每个inode大小均固定为128Bytes（新的ext4与xfs可设置到256Bytes）； 
    - 每个文件都仅会占用一个inode而已，因此文件系统能够创建的文件数量与inode的数量有关；
    - 系统读取文件时需要先找到inode，并分析inode所记录的权限与使用者是否符合，若符合才能够开始实际读取block的内容。
- block：实际记录文件的内容，若文件太大时，会占用多个block。
- 数据存放区域：inode table 与 data block 
- metadata (中介数据) ：superblock、 block bitmap 与 inode bitmap 等区段
- mount point：每个 filesystem 都有独立的 inode / block / superblock 等信息，这个文件系统要能够链接到目录树才能被我们使用。 将文件系统与目录树结合的动作我们称为挂载。
  - 挂载点一定是目录，该目录为进入该文件系统的入口
- Linux VFS (Virtual Filesystem Switch)
  - Linux 的核心通过Virtual Filesystem Switch 的核心功能去读取 filesystem，管理文件系统

- df ： disk free
- du： disk usage
- ln
  - Hard Link：hard link 只是在某个目录下新增一笔档名链接到某 inode 号码的关连记录
    - 作用：如果你将任何一个『档名』删除，其实 inode 与 block 都还是存在的！ 此时你可以透过另一个『档名』来读取到正确的文件数据
    - 限制：不能跨 Filesystem；不能 link 目录。

  - Symbolic Link： Symbolic link 就是在创建一个独立的文件，而这个文件会让数据的读取指向他 link 的那个文件的档名！由于只是利用文件来做为指向的动作， 所以，当来源档被删除之后，symbolic link 的文件会『开不了』
    - 目录的 link 数量：一个『空目录』里面至少会存在 . 与 .. 这两个目录
- 磁盘分区： fdisk
  - 磁盘格式化：mkfs，make filesystem
  - 注意
    - 单一文件系统不应该被重复挂载在不同的挂载点(目录)中；
    - 单一目录不应该重复挂载多个文件系统；
    - 要作为挂载点的目录，理论上应该都是空目录才是。

  - 挂载：mount
    - 启动挂载 /etc/fstab 及 /etc/mtab
      - 根目录 / 是必须挂载的﹐而且一定要先于其它 mount point 被挂载进来。
      - 其它 mount point 必须为已创建的目录﹐可任意指定﹐但一定要遵守必须的系统目录架构原则
      - 所有 mount point 在同一时间之内﹐只能挂载一次。
      - 所有 partition 在同一时间之内﹐只能挂载一次。
      - 如若进行卸除﹐您必须先将工作目录移到 mount point(及其子目录) 之外。
    - 文件系统参数


### 压缩和解压



# 实际操作篇

## 远程登录

## Vi和Vim编辑器

- vi是“Visual”的不正规的缩写，来源于另外一个文本编辑器ex的命令visual。
- Linux系统会内置vi文本编辑器
- Vim 具有程序编辑的能力，可以看做是Vi的增强版本，可以主动的以字体颜色辨别语法的正确性，方便程序设计。代码补完、编译及错误跳转等方便编程的功能特别丰富，在程序员中被广泛使用。
- ![img](Linux.assets/vi-vim-cheat-sheet-sch.gif)

### 模式

- 一般命令模式(command mode)：以 vim打开一个档案就直接进入一般模式了(这是默认的模式)。在这个模式中，你可以使用『上下
  左右』按键来移动光标，你可以使用『删除字符』或『删除整行』来处理档案内容，也可以使用『复制、粘贴』来处理你的文件数据。
- 编辑模式（insert mode）：按下i,L, o, 0, a, A, r, R等任何一个字母之后才会进入编辑模式,一般来说按i即可.
- 命令行模式(command-line mode)：在这个模式当中，可以提供你相关指令，完成读取、存盘、替换、离开vim、显示行号等的动作则是在此模式中达成的!

#### command mode

- 新增 (append)

  - a ：从光标所在位置後面开始新增资料，光标後的资料随新增资料向後移动。
  - A： 从光标所在列最後面的地方开始新增资料。

- 插入 (insert)

  - i： 从光标所在位置前面开始插入资料，光标後的资料随新增资料向後移动。


  - I ：从光标所在列的第一个非空白字元前面开始插入资料。

- 开始 (open)

  - o ：在光标所在列下新增一列并进入输入模式。


  - O: 在光标所在列上方新增一列并进入输入模式。

- x： 删除光标所在字符。

- dd ：删除光标所在的列。

- r ：修改光标所在字元，r 後接著要修正的字符。

- R： 进入取替换状态，新增文字会覆盖原先文字，直到按 [ESC] 回到指令模式下为止。

- s： 删除光标所在字元，并进入输入模式。

- S： 删除光标所在的列，并进入输入模式。

#### 命令行模式

- ？/ :

## 实用指令

## 指令

- ```java
  [dmtsai@study ~]$ command [-options] parameter1 parameter2 ...
  ```

  - 一行指令中第一个输入的部分绝对是“指令（command）”或“可可执行文件案（例如批次脚本,script）”
  - command为指令的名称，例如变换工作目录的指令为	cd	等等；
  - 中刮号[]并不存在于实际的指令中，而加入选项设置时，通常选项前会带-号，例如-h； 有时候会使用选项的完整全名，则选项前带有--符号，例如--help；
  - parameter1	parameter2..	为依附在选项后面的参数，或者是	command	的参数；
  - 指令,	选项,	参数等这几个咚咚中间以空格来区分，不论空几格shell都视为一格。所以空格是很重要的特殊字符！；
  - 按下[Enter]按键后，该指令就立即执行。[Enter]按键代表着一行指令的开始启动。
  - 指令太长的时候，可以使用反斜线（\）来跳脱[Enter]符号，使指令连续到下一行。注意！反斜线后就立刻接特殊字符，才能跳脱！
  - 在Linux系统中，英文大小写字母是不一样的。举例来说，cd与CD并不同。
  - 参数的单-和双-
    1. 用单-的说明后面的参数是字符形式。
    2. 参数用双-的说明后面的参数是单词形式。
    3. 参数前有-的是 System V风格。
    4. 参数前没有-的是 BSD风格。
    5. 有关System V和BSD的其他区别：
       - 系统启动过程中 kernel 最后一步调用的是 init 程序，init 程序的执行有两种风格，即 System V 和 BSD。
       - System V 风格中 init 调用 /etc/inittab，BSD 风格调用 /etc/rc，它们的目的相同，都是根据 runlevel 执行一系列的程序。
  - 引号
    1. **单引号**将其中的内容都作为了字符串来，忽略所有的命令和特殊字符,类似于一个字符串的用法。
    2. 双引号与单引号的区别在于其可以包含特殊字符(单引号直接输出内部字符串，不解析特殊字符；双引号内则会解析特殊字符)，包括', ", $, \,如果要忽略特殊字符，就可以利用\来转义，忽略特殊字符，作为普通字符输出。
    3. 反引号用来包含一个命令字符串的，其中的命令会先执行，得到的结果会返回到层命令再执行。

- tap

  - 补全命令
  - 补全文件名
  - 补全选项、参数

- ctrl d：键盘输入结 束（End Of File, EOF 或 End Of Input）”的意思！也可以用来取代exit的输入

- shift+pageup/pagedown：看之前的命令或者之后的命令

- man command、help command、command --help查看帮助

  - man：manual
    - man代号：![image-20220914171749688](Linux.assets/image-20220914171749688.png)

- Path

  - 可执行文件路径的变量

  - ```shell
    [root@study ~]# PATH="${PATH}:/root" #将/root加入到可执行文件路径的变量中
    ```

### shell

- 历史：第一个流行的 shell 是由Steven Bourne 发展出来的，为了纪念他所以就称为Bourne shell ，或直接简称为sh ！而后来另一个广为流传的shell 是由柏克莱大学的Bill Joy 设计依附于BSD 版的Unix 系统中的shell ，这个shell 的语法有点类似 C 语言，所以才得名为C shell ，简称为csh ！由于在学术界Sun 主机势力相当的庞大，而Sun 主要是BSD 的分支之一，所以C shell 也是另一个很重要而且流传很广的shell 之一。

- 设定别名

  - ```shell
    [root@study ~]# alias lm='ls -al'
    ```

### 关机&重启

- | 命令                                | 说明                                  |
  | ----------------------------------- | ------------------------------------- |
  | shutdown -h now(或直接使用shutdown) | 立该进行关机                          |
  | shudown -h 1                        | 会给其他用户发"hello,1分钟后会关机了" |
  | shutdown -r now                     | 现在重新启动计算机                    |
  | halt                                | 关机，作用和上面一样.                 |
  | reboot                              | 重新启动计算机                        |
  | sync                                | 把内存的数据同步到磁盘                |

  - 不管是重启系统还是关闭系统，首先要运行sync命令，把内存中的数据写到磁盘中
  - 目前的shutdown/reboot/halt等命令均已经在关机前进行了sync

### 用户登录和注销

- 登录时尽量少用root帐号登录，因为它是系统管理员，最大的权限，避免操作失误。可以利用普通用户登录，登录后再用”su-用户名’命令来切换成系统管理员身份.
- 在提示符下输入logout即可注销用户
- logout 注销指令在图形运行级别无效，在运行级别3下有效

## 进程管理

## 用户管理

## 定时任务调度

## RPM和YUM

## 开机、重启和用户登录注销

## 磁盘分区、挂载

## 网络配置

# 高级篇

## 日志管理

## linux内核源码&内核升级

## 定制自己的linux

## linux备份与恢复

## Linux可视化管理webmin和bt运维工具

## linux入侵检测&权限划分&系统优化

## linux面试题

