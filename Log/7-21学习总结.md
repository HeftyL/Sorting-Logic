# 简述

- 大话通讯
  - 公共电话交换网的电话号码分配、拓扑结构和话务强度测定
  - 交换机的基础概念和程控交换机的路由表和信令
  - 智能网是什么，以及智能网的核心技术软交换相关概念和智能网的语音通话VoIP
  - 实时通信的相关技术：实时传输协议RTP

# 电话交换网

## 公共电话交换网(PSTN)

- 电话号码分配
  - 要求
    - 号码长度必须规范
    - 号码前缀代表某个特定地区或者特定应用
  - 国际上制定了全球规范，各个国家在国际规范的基础上结合自身特点制定了本国规范。中国本地网规范：
    - 本地网的编号：本地网用户进行长途、特种业务等通信时，由首位号区分。
      - 1为特种业务号码或移动电话号码的首位号
      - 2～8为市话号码的首位号
      - 9为长市话号码或市郊号码的首位号 
      - 0为长途全自动的字冠前缀
    - 特种业务号码和特服号码
      - 特种业务号码不同于普通用户的号码，是作为电信业务和社会服务而设的，要求接续速度快、准确无误，因此特种业务的电话号码位数少，有利于用户记忆和拨打。
      - 10开头的5位号码，是电信运营商保留的特别服务号码，如10000。以10开头的3位号码，都是和国际电话业务有关的特服号码。部分以13、14、 
        15、17和18开头的11位号码，属于移动运营商使用的手机号码段。
    - 长途网的编号：长途前缀（“0”）+区号+本地网号码
    - 国际电话编号
      - 要拨打国际长途，就必须先拨呼叫国际电话的标志号，这个号由国内长话局接收识别后，呼叫接入国际电话网。每个国家的标志号不完全相同。
      - 国际长途的区号，国家号码：按ITU规定， 国家号码由1～3位数字组成，第1位数为“世界编号区”，即世界分成若干个编号区，每个编号区配1位号码。
- 拓扑结构
  - PSTN是由电话机、电话交换机和它们之间的连线组成的。PSTN中的交换机组成特定的“形状”，有助于有效利用资源、提高电话呼叫的稳定性。
  - 程控交换机都有一个中继单元，中继单元上有若干个中继端口，任意两台程控交换机的中继端口，如果速率一致、信令一致，就可以通过数字中继线连接起来。信令可以是7号信令，也可以是PRI信令。
  - 电话交换网最适合的拓扑结构是树状结构，自上而下的行政管理模型。但是在较为核心的层面，一般采用全网状或不完全网状结构，用于对路由备份
  - 城市的每台直接连接用户的交换局都部署一定容量的程控交换机，它们一边通过铜线连接用户的电话机，一边通过E1/T1或者STM-1连接汇接层交换机。这就是我们之前提到的C5局连接到C4局。
  - 国家级语音骨干网一般按照国家行政区划分为几个大区，每个大区设置一个核心节点，所有该大区的省份，其核心地市的交换机直连大区核心节点
  - 交换机一般都可以设置“迂回路由”

- 电话接入网（AN）
  - “接入网”（AN，Access Network），特指语音网络。AN是一种将PSTN用更加廉价的方式接入企业和家庭的网络形式。
- 话务强度测定
  - 在语音通信网络中，“爱尔兰”（Erl）是衡量话务量大小的指标。它根据语音信道的占空比来计算。
  - 呼叫频率
    - 忙时试呼次数（BHCA，Busy Hour Call Attempts）：在一小时之内，系统能建立通话连接的绝对数量值
    - 每秒建立呼叫数量（CAPS，Call Attempts Per Second）：BHCA值最后体现为CAPS， CAPS×3600=BHCA

## 交换机原理

- 交换机基本能力
  - 寻址：必须能够通过路由表识别出应该如何找到被叫方。
  - 建链/拆链：必须有指挥“搭通”电路的能力，并在通话结束后拆除电路。
  - 交换：可以识别主叫方的请求并通过内部机制搭通电路。
  - 馈电：如果连接了电话机，必须能够向电话机供电。
  - 记录：CDR（Call Detail Records），存储能够存储所有电话通话的重要参数，如起始时间、终止时间、时长、主叫号码、被叫号码等，以作为计费的依据。

### 程控交换机

- 路由表
  - 路由表中所有内容都是根据实际网络情况人为设定的，不是交换机通过某种机制自动获得的。程控交换网的号码分配非常规则，因此路由也非常规则：根据不同的被叫号码，选择不同的出局路径。
- 信令
  - 在网络中传输着各种信号，其中一部分是我们需要的（例如打电话的语音，上网的数据包等等），而另外一部分是我们不需要的（只能说不是直接需要）它用来专门控制电路的，这一类型的信号我们就称之为信令，信令的传输需要一个信令网。
  - 作用：通过特定格式的“语言”，在PSTN的各个交换机之间、交换机与电话机之间互相转告消息，并共同处理一次通信的整个过程。
  - 作用区域分类
    - 用户线信令：在用户线两头交互，用于电话机和交换机之间的信令传递
    - 局间信令：在交换机之间的中继线两头交互，也就是两台交换机之间的信令传递。
  - 话路数量分类
    - 随路信令：随路信令是指信令和语音在同一条话路中传送的信令方式
    - 共路信令：共路信令是在一条高速数据链路上传送一群话路信令的信令方式

## 智能网

- “增值业务”：指通话以外的所有业务
- 增值业务方式
  - 直接通过程控交换机实现
    - 缩位拨号：在电信公司办理完这项业务后，你就可以把自己经常拨打的一些电话，用1～3位自编代码来代替。
    - 呼叫前转：你可以在离开家或办公室时，把临时去处的电话号码“告诉”PSTN，这以后，打到你家或者办公室的电话便会自动转移到你的临时去处的电话号码
    - 遇忙回叫：启用“遇忙回叫”服务后，拨不通电话时便可挂上话筒等待，一旦对方电话空出来，交换机便会自动回叫你的电话
    - 三方通话：在不中断与对方通话的情况下拨叫第三方，实现三方共同通话。
  - “智能网”：控制权的分离，程控交换机只完成基本的交换和话务统计功能，业务控制逻辑则由专门的部件——业务控制点（SCP，Service Control Point）来完成

### 软交换网络

- 背景：智能网提出了业务与交换分离，但这两者之间的复杂信令，让技术体制上的分离，变成了技术难度垄断上的合并，没有足够的实力，要通过智能网开发新业务，仍然困难重重
- 下一代网络（Next Generation Network，NGN）：NGN不是某个具体协议，也不是某项具体的技术创造或者技术创新，而是在基于任何传送、交换、路 
  由等技术机制的网络架构基础上的、更加符合行业价值链成长的、更能快速实现用户个性化需求的新一代电信网络架构。
- 交换硬度分类，交换芯片与控制软件是否解耦
  - “硬交换”：控制软件不独立于交换芯片
  - “软交换”：控制软件独立于交换芯片
- 要求
  - 承载与控制分离：控制是指对NGN中所有组成部件的协调、组织和管理，而这种控制不依托于任何一种承载网络。
  - 业务与呼叫分离
- NGN/软交换是基于TDM的PSTN语音网络和基于IP/MPLS分组网络融合的产物
- 特点
  - 平滑继承PSTN的语音业务和智能网业务；
  - 语音增值业务提供能力更为灵活，且具备支持多媒体业务的能力。
- 组件
  - 内部控制部分：采用通用的CPU或者专用高端CPU，加入IP端口，采用标准信令呼叫协议（如 H.323或SIP或其他），并提供标准的增值业务开发API，就成了一台软交换服务器（“大脑”）。
  - 外接线部分：外接口线部分增加IP端口后，加入适当的逻辑控制部分，就成了我们常说的“网关”（Gateway）或综合接入设备（IAD，Integrated Access Device），网关和IAD就是“四肢”了。
- 实体：应用服务器、信令网关、媒体网关

### IP呼叫信令

- NGN主要承载在IP/MPLS网络之上。NGN、软交换的各种实体都将采用IP呼叫信令来建立链路，这就像基于TDM网络的PSTN各个实体之间采用电话信令进行通信一样。最常用的IP呼叫信令有H.323、SIP、MGCP/H.248等

#### H.323协议

- 会议电视系统标准：把基于局域网的多媒体系统连接到基于广域网络的多媒体系统上。
  - H.320：基于ISDN的TDM电路
  - H.323：基于IP分组
- H.323是一个“协议族”，由一系列协议组成的“框架性结构规范”，包含了多种ITU标准。H.323架构定义了4个主要的组件终端（Terminal）、网关（Gateway）、关守（Gatekeeper，简写为GK，也称“网守”）、多点控制单元（MCU， Multi-Point Control Unit）。
  - GK作为核心管理和控制部件，与所有终端建立关系， 当有呼叫申请，通过号码把主叫与被叫呼通，并通过MCU控制媒体流的混合和分发，形成会议机制。
  - 当需要与其他体制的网络互通时，如和PSTN语音互通，还要通过网关在中间进行翻译

#### SIP

- 会话初始化协议（SIP，Session Initial Protocol）
- SIP是一种应用层控制协议，它可用来创建、修改或终止多媒体会话
- SIP 能够邀请参与者加入已存在的会话，如组播会议。现有的会话中可以添加或删除媒体。SIP 支持名称映射和重定向服务，其支持用户移动性。

#### H.323协议与SIP

- H.323和SIP分别是通信领域与互联网两大阵营推出的建议
  - H.323试图把IP电话当作是众所周知的传统电话，只是传输方式发生了改变，由电路交换变成了分组交换。 
  - SIP侧重于将IP电话作为互联网上的一个应用，较其他应用（如FTP、E-mail等）增加了信令和QoS的要求。

#### MGCP与MeGaCo/H.248

- 媒体网关控制协议（MGCP）一般应用于分开的多媒体网关单元之间。
  - 组成部件
    - 媒体网关控制器（MGC）：负责媒体控制，执行对媒体网关的管理、控制
    - 多媒体网关（MG）：负责媒体处理和转换的叫作，执行由TDM语音到VoIP的转化。
- MeGaCo/H.248被看作是MGCP的升级版本

### VoIP

- VoIP，其实就是将语音的媒体流从TDM转换到IP网络的所有技术体制的总称。
- VoIP技术为NGN、软交换技术提供了丰富的历史经验和教训，并成为这两者的重要技术基础。

### NGN

- 业务驱动型网络架构：NGN被定义为一种全新的电信网络体系架构， 它融合了IP/MPLS技术和多媒体通信技术，提出了分层和开放的概念，从面向技术和管理的传统电信网络转变成面向客户、面向业务的新一代网络
- 关键技术：软交换
- 特点：架构开放、业务驱动、支持分组化承载和拥有独立的网络控制层
- 问题
  - 网络安全
  - 承载网QoS
  - 网络互连互通
- 未来：融合：“融合”可以向用户提供各种形式的业务和“一站式”的服务，使用户不管是在固定环境中还是在移动环境中都能享受同样的服务。

## 实时传输协议RTP

- Real-time Transport Protocol，RTP协议详细说明了在互联网上传递音频和视频的标准数据包格式。它一开始被设计为一个多播协议，但后来被用在很多单播应用中。RTP协议常用于流媒体系统（配合RTSP协议）
- 升级：RTP结合RTCP
  - RTP本身并不能为按顺序传送数据包提供可靠的传送机制，也无法规避网络拥塞
  - RTCP触发每个参与通话者周期性地传送RTCP包，其中含有已发送数据包的数量、丢失数据包的数量等统计资料。 发送方可以利用这些信息动态地改变传输速率，甚至改变有效载荷类型

## IP网络的语音编码

- 在IP网络上传送语音，可以对数字语音编码进行压缩后传送，节省带宽资源，减少语音时延，但也不可避免地损失了声音的信息。